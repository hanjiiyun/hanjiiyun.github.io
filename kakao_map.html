<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
  />
  <title>R2U Kakao Map</title>
  <style>
    html, body { margin:0; padding:0; height:100%; }
    #map { width:100%; height:100vh; }
  </style>
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=f3beaea643bdd2136019b366df1190cf"></script>
</head>
<body>
  <div id="map"></div>

  <script>
    // ğŸ”¹ ì „ì—­ ë³€ìˆ˜ (ë‹¤ë¥¸ í•¨ìˆ˜ì—ì„œë„ ì“¸ ìˆ˜ ìˆë„ë¡ varë¡œ ì„ ì–¸)
    var map;
    var routeLine = null;
    var startMarker = null;
    var endMarker = null;

    // ğŸ”¹ ì§€ë„ ìƒì„±
    (function initMap() {
      const container = document.getElementById('map');
      const options = {
        center: new kakao.maps.LatLng(37.4507, 126.6530), // ì¸í•˜ëŒ€ ê·¼ì²˜
        level: 3
      };
      map = new kakao.maps.Map(container, options);
    })();

    // ğŸ”¹ Flutterì—ì„œ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜: ì¶”ì²œ ê²½ë¡œ í‘œì‹œ
   // ğŸ”¹ Flutterì—ì„œ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜: ì¶”ì²œ ê²½ë¡œ í‘œì‹œ
function showRecommendedRoute(routeData) {
  console.log("ğŸ“¡ ë°›ì€ ì›ë³¸ ë°ì´í„°:", routeData);
  console.log("ğŸ“ start:", routeData.start.lat, routeData.start.lng);
  console.log("ğŸ“ first poly:", routeData.polyline[0].lat, routeData.polyline[0].lng);


  // 1) polyline ìœ íš¨ì„± ì²´í¬
  if (!routeData || !Array.isArray(routeData.polyline)) {
    console.log("âš  polyline ë°°ì—´ì´ ì—†ìŠµë‹ˆë‹¤. keys:", Object.keys(routeData || {}));
    return;
  }

  console.log("ğŸ“ polyline ê¸¸ì´:", routeData.polyline.length);

  // 2) LatLng ë°°ì—´ë¡œ ë³€í™˜
  var linePath = routeData.polyline.map(function(p) {
    // ìˆ«ìë¡œ í•œ ë²ˆ ê°•ì œ ë³€í™˜ (í˜¹ì‹œ ë¬¸ìì—´ì´ë©´ ëŒ€ë¹„)
    var lat = Number(p.lat);
    var lng = Number(p.lng);
    return new kakao.maps.LatLng(lat, lng);
  });

  if (linePath.length === 0) {
    console.log("âš  linePathê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.");
    return;
  }

  // 3) ê¸°ì¡´ ê²½ë¡œ/ë§ˆì»¤ ì œê±°
  if (routeLine) {
    routeLine.setMap(null);
  }
  if (startMarker) startMarker.setMap(null);
  if (endMarker) endMarker.setMap(null);

  // 4) ìƒˆ Polyline ìƒì„± (ì´ˆë¡ìƒ‰)
  routeLine = new kakao.maps.Polyline({
    map: map,
    path: linePath,
    strokeWeight: 5,
    strokeColor: '#00C853',
    strokeOpacity: 0.9,
    strokeStyle: 'solid'
  });

  // 5) ì‹œì‘/ë ë§ˆì»¤
  var startPos = linePath[0];
  var endPos = linePath[linePath.length - 1];

  startMarker = new kakao.maps.Marker({
    map: map,
    position: startPos
  });

  endMarker = new kakao.maps.Marker({
    map: map,
    position: endPos
  });

  // 6) í™”ë©´ì„ ì „ì²´ ê²½ë¡œì— ë§ì¶”ê¸° (ê°€ì¥ í™•ì‹¤í•˜ê²Œ ë³´ì´ê²Œ)
  var bounds = new kakao.maps.LatLngBounds();
  linePath.forEach(function (pos) {
    bounds.extend(pos);
  });
  map.setBounds(bounds);

  console.log("âœ… í´ë¦¬ë¼ì¸/ë§ˆì»¤ í‘œì‹œ ì™„ë£Œ");
}
// ==========================
// ğŸ”µ ì‚¬ìš©ì í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ í‘œì‹œ í•¨ìˆ˜
// ==========================
let userMarker = null;

function showUserLocation(lat, lng) {
    if (!map) {
        console.log("âŒ map ê°ì²´ ì—†ìŒ");
        return;
    }

    // ê¸°ì¡´ ì‚¬ìš©ì ë§ˆì»¤ ì œê±°
    if (userMarker) {
        userMarker.setMap(null);
    }

    // ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤ ì•„ì´ì½˜ (íŒŒë€ ì•„ì´ì½˜)
    const markerImage = new kakao.maps.MarkerImage(
        "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png",
        new kakao.maps.Size(24, 35)
    );

    // ìƒˆ ë§ˆì»¤ ìƒì„±
    userMarker = new kakao.maps.Marker({
        position: new kakao.maps.LatLng(lat, lng),
        map: map,
        image: markerImage
    });

    // ì§€ë„ ì¤‘ì•™ìœ¼ë¡œ ì´ë™
    map.setCenter(new kakao.maps.LatLng(lat, lng));

    console.log("ğŸ“ ì‚¬ìš©ì ìœ„ì¹˜ í‘œì‹œ ì™„ë£Œ:", lat, lng);
}


  </script>
</body>
</html>
